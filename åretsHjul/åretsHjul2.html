<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Rotatable Hebrew Calendar Wheel</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f4f4f4;
      user-select: none;
    }

    .rot-layout {
      display: flex;
      align-items: center; /* vertical centering */
      justify-content: center;
      gap: 1rem;
    }

    .rot-layout button {
      padding: 0.5em 0.8em;
      font-size: 1em;
      border: 1px solid #aaa;
      border-radius: 0.5em;
      background: #eee;
      cursor: pointer;
    }

    .rot-container {
      display: inline-block;
      touch-action: none;
      cursor: grab;
    }
    .rot-container.dragging { cursor: grabbing; }

    img.rotatable {
      display: block;
      transform-origin: 50% 50%;
      max-width: none;  /* allow unlimited scaling */
      max-height: none;
    }

    .angle-label {
      text-align: center;
      margin-top: 8px;
      font-family: system-ui, sans-serif;
      font-size: 13px;
      color: #333;
    }
  </style>
</head>
<body>

<div class="rot-layout">
  <button id="resetBtn">⟲ Reset</button>
  <div id="rotWrap" class="rot-container" title="Drag to rotate">
    <img id="rotImg" class="rotatable" src="./åretsHjul.drawio.svg" alt="rotatable wheel">
    <div id="angle" class="angle-label">0°</div>
  </div>
</div>

<!-- Hebrew calendar library -->
<script type="module">
  import { HDate } from "https://unpkg.com/hebcal/dist/esm/hebcal.esm.js";

  (function() {
    const wrap = document.getElementById('rotWrap');
    const img = document.getElementById('rotImg');
    const angleLabel = document.getElementById('angle');
    const resetBtn = document.getElementById('resetBtn');

    let dragging = false;
    let startAngleRad = 0;
    let startRotationDeg = 0;
    let currentRotationDeg = 0;

    function getCenter(elem) {
      const r = elem.getBoundingClientRect();
      return { x: r.left + r.width / 2, y: r.top + r.height / 2 };
    }
    function pointerToAngle(ev, center) {
      const dx = ev.clientX - center.x;
      const dy = ev.clientY - center.y;
      return Math.atan2(dy, dx);
    }
    function radToDeg(rad) { return rad * 180 / Math.PI; }

    // Hebrew calendar
    const monthsLeap = [
      'Nisan','Iyyar','Sivan','Tammuz','Av','Elul',
      'Tishrei','Cheshvan','Kislev','Tevet','Shevat','Adar I','Adar II'
    ];
    const monthsRegular = [
      'Nisan','Iyyar','Sivan','Tammuz','Av','Elul',
      'Tishrei','Cheshvan','Kislev','Tevet','Shevat','Adar'
    ];

    function getHebrewAngle() {
      const today = new Date();
      const hdate = new HDate(today);
      const isLeap = hdate.isLeapYear();

      const months = isLeap ? monthsLeap : monthsRegular;
      const monthName = hdate.monthName();
      const day = hdate.day;
      const monthLength = hdate.daysInMonth();

      let idx = months.indexOf(monthName);
      if (idx === -1) {
        console.warn('Unexpected month name:', monthName);
        idx = 0;
      }

      const fraction = (day - 1) / monthLength;
      const pos = idx + fraction;
      const degreesPerMonth = 360 / months.length;

      return -90 - pos * degreesPerMonth;
    }

    function setInitialRotation() {
      currentRotationDeg = getHebrewAngle();
      img.style.transform = `rotate(${currentRotationDeg}deg)`;
      angleLabel.textContent = `${Math.round(currentRotationDeg)}°`;
    }

    setInitialRotation();

    // Drag rotation
    wrap.addEventListener('pointerdown', function(ev) {
      ev.preventDefault();
      wrap.setPointerCapture(ev.pointerId);
      dragging = true;
      wrap.classList.add('dragging');

      const center = getCenter(img);
      startAngleRad = pointerToAngle(ev, center);
      startRotationDeg = currentRotationDeg;
    });

    wrap.addEventListener('pointermove', function(ev) {
      if (!dragging) return;
      ev.preventDefault();

      const center = getCenter(img);
      const angleNowRad = pointerToAngle(ev, center);
      let deltaRad = angleNowRad - startAngleRad;
      if (deltaRad > Math.PI) deltaRad -= 2 * Math.PI;
      if (deltaRad < -Math.PI) deltaRad += 2 * Math.PI;

      const deltaDeg = radToDeg(deltaRad);
      currentRotationDeg = startRotationDeg + deltaDeg;

      img.style.transform = `rotate(${currentRotationDeg}deg)`;
      angleLabel.textContent = `${Math.round(currentRotationDeg)}°`;
    });

    function endDrag(ev) {
      if (!dragging) return;
      dragging = false;
      wrap.classList.remove('dragging');
      try { wrap.releasePointerCapture(ev.pointerId); } catch (e) {}
    }

    wrap.addEventListener('pointerup', endDrag);
    wrap.addEventListener('pointercancel', endDrag);

    resetBtn.addEventListener('click', () => {
      setInitialRotation();
    });

  })();
</script>

</body>
</html>
